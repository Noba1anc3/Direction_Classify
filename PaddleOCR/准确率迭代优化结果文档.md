# 准确率迭代优化结果文档

## 1. 测试环境
- CPU : Intel® Core™ i7-7500U CPU @ 2.70GHz × 4 
- Memory : 16GB

## 2. 分类标准
- 根据长宽比确定文档是上下型还是左右型
- 对分类结果进行投票确认文字阅读方向是自左向右还是自右向左

## 3. Baseline

- 无预处理
- 无检测优化
- 基于分数的文字方向投票

### 总体情况

| 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:-------:|:-------------:|:--------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| 96.44%  | 99.69%        | 99.78%         | 99.61%        | 96.58%        | 97.24%         | 95.95%        |

### 方向

| 方向准确率      | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:--------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| 平均           | 99.66% |  99.78%  |  92.17%  |   94.31%  |  96.44% |

### 种类

| 种类            | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:---------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| 证件            | 100.0% |  100.0% |    88.53% |    93.97% |  95.38% |
| 文档            | 99.69% |  99.64% |    89.47% |    89.90% |  94.67% |
| 票据            | 99.33% |  99.68% |    95.79% |    98.93% |  98.42% |
| 其他            | 100.0% |  100.0% |    97.03% |    95.15% |  98.00% |

## 4. 错因探究


## 5. 优化方案

### 3.1 预处理

- 二值化 : 对图片做高斯自适应二值化
- 微调转正 : 运用最大矩形框检测法对图片进行角度微调

### 3.2 检测优化

- 检测结果宽高比过滤 : 对检测框不符合投票结果方向宽高比的，进行删除过滤
- 修正仿射变换 : 对横纵边之比与仿射变换宽高比在`1`两侧的矩形框，进行坐标顺序调整

### 3.3 分类优化

- 基于个数的文字方向投票 : 使用个数而非置信度进行投票

### 3.4 复合优化

- 微调转正 + 检测结果宽高比过滤
- 微调转正 + 检测结果宽高比过滤 + 删除错误仿射变换
  - 删除错误仿射变换 : 对横纵边之比与仿射变换宽高比在`1`两侧的矩形框，进行删除
- 微调转正 + 检测结果宽高比过滤 + 旋转阈值为1的仿射变换
  - 旋转阈值 : 对经过仿射变换处理后的矩形框，如若高宽比 > 1，进行旋转 (Baseline中该阈值为1.5)
- 微调转正 + 二值化 + 检测结果宽高比过滤
- 微调转正 + 二值化 + 检测结果宽高比过滤 + 修正仿射变换

## 6. 基于Baseline的优化

| 总体情况               | 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:---------------------:|:--------:|:-------------:|:-------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| Baseline              |  96.44%  | 99.69%        | 99.78%        | 99.61%        | 96.58%        | 97.24%         | 95.95%        |
| 基于个数的文字方向投票 |  95.94%  | 99.69%        | 99.78%        | 99.61%        | 96.08%        | 97.24%         | 94.96%        |
| 修正仿射变换           |  96.61%  | 99.69%        | 99.78%        | 99.61%        | 96.75%        | 97.13%         | 96.39%        |
| 检测结果宽高比过滤     |  96.86%  | 99.69%        | 99.78%        | 99.61%        | 97.00%        | 97.58%         | 96.44%        |


| 方向准确率             | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:---------------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| Baseline              | 99.66% |  99.78%  |  92.17%  |   94.31%  |  96.44% |
| 基于个数的文字方向投票 | 99.66% |  99.33%  |  90.67%  |   94.31%  |  95.94% |
| 修正仿射变换           | 99.66% |  99.78%  |  93.03%  |   94.08%  |  96.61% |
| 检测结果宽高比过滤     | 99.66% |  99.66%  |  93.24%  |   94.99%  |  96.86% |

## 7. 预处理

| 总体情况               | 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:---------------------:|:--------:|:-------------:|:-------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| Baseline              |  96.44%  | 99.69%        | 99.78%        | 99.61%        | 96.58%        | 97.24%         | 95.95%        |
| 二值化                |  96.47%  | 99.67%        | 99.66%        | 99.67%        | 96.69%        | 97.18%         | 96.22%        |
| 微调转正              |  99.11%  | 99.72%        | 99.78%        | 99.67%        | 99.31%        | 99.72%         | 98.90%        |


| 方向准确率             | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:---------------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| Baseline              | 99.66% |  99.78%  |  92.17%  |   94.31%  |  96.44% |
| 二值化                | 99.66% |  98.99%  |  93.13%  |   94.20%  |  96.47% |
| 微调转正              | 99.55% |  99.78%  |  97.75%  |   99.43%  |  99.11% |

## 8. 复合优化

| 总体情况                                            | 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:--------------------------------------------------:|:--------:|:-------------:|:-------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| Baseline                                           |  96.44%  | 99.69%        | 99.78%        | 99.61%        | 96.58%        | 97.24%         | 95.95%        |
| 微调转正 + 二值化 + 检测结果宽高比过滤               |  98.97%  | 99.56%        | 99.61%        | 99.50%        | 99.14%        | 99.61%         | 98.69%        |
| 微调转正 + 二值化 + 检测结果宽高比过滤 + 修正仿射变换 |  98.81%  | 99.56%        | 99.61%        | 99.50%        | 98.97%        | 98.49%         | 98.47%        |

| 总体情况                                            | 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:--------------------------------------------------:|:--------:|:-------------:|:-------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| 微调转正 + 检测结果宽高比过滤                        |  99.47%  | 99.72%        | 99.78%        | 99.67%        | 99.61%        | 99.89%         | 99.34%        |
| 微调转正 + 检测结果宽高比过滤 + 删除错误仿射变换      |  98.89%  | 99.56%        | 99.61%        | 99.50%        | 99.06%        | 99.61%         | 98.52%        |
| 微调转正 + 检测结果宽高比过滤 + 旋转阈值为1的仿射变换 |  99.39%  | 99.72%        | 99.78%        | 99.67%        | 99.58%        | 99.83%         | 99.34%        |


| 方向准确率                                          | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:--------------------------------------------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| Baseline                                           | 99.66% |  99.78%  |  92.17%  |   94.31%  |  96.44% |
| 微调转正 + 二值化 + 检测结果宽高比过滤               | 99.55% |  98.77%  |  98.39%  |   99.20%  |  98.97% |
| 微调转正 + 二值化 + 检测结果宽高比过滤 + 修正仿射变换 | 99.55% |  98.77%  |  97.96%  |   98.98%  |  98.81% |

| 方向准确率                                          | Up acc | Down acc | Left acc | Right acc | Avg acc |
|:--------------------------------------------------:|:------:|:--------:|:--------:|:---------:|:-------:|
| 微调转正 + 检测结果宽高比过滤                        | 99.55% |  99.78%  |  98.71%  |   99.89%  |  99.47% |
| 微调转正 + 检测结果宽高比过滤 + 删除错误仿射变换      | 99.55% |  98.77%  |  98.07%  |   99.20%  |  98.89% |
| 微调转正 + 检测结果宽高比过滤 + 旋转阈值为1的仿射变换 | 99.55% |  99.78%  |  98.61%  |   99.60%  |  99.39% |

