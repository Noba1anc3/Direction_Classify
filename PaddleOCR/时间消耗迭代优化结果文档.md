# 准确率迭代优化结果文档

## 1. 测试环境
- CPU环境
  - CPU : Intel® Core™ i7-7500U CPU @ 2.70GHz × 4 
  - Memory : 16GB
- GPU环境
  - 不同模型对性能影响实验 : Tesla P100 16280MiB
  - 矩形框对分类性能影响实验 : Tesla K80 11441MiB

## 2. 分类标准
- 根据长宽比确定文档是上下型还是左右型
- 对分类结果进行投票确认文字阅读方向是自左向右还是自右向左

## 3. Baseline

- 预处理
  - 微调转正 : 运用最大矩形框检测法对图片进行角度微调
- 检测优化
  - 逆宽高比过滤 : 对检测框不符合投票结果方向宽高比的，进行删除过滤
  - 阈值宽高比过滤 : 对经过仿射变换及旋转处理后检测框宽高比小于`2`的，进行删除过滤
- 分类优化
  - 基于分数的文字方向投票

### 时间

| 时间消耗  | 最大值   | 最小值 | 平均值 |
|:---------:|:-------:|:------:|:------:|
| 检测时间  | 3072.5  |  24.66 | 426.20 |
| 分类时间  | 8117.7  |    0.0 | 376.26 |
| 总时间    | 8651.7  |  30.43 | 802.46 |

### 总体情况

| 方向准确率 | Avg acc | Up acc | Down acc | Left acc | Right acc |
|:----------:|:-------:|:------:|:--------:|:--------:|:---------:|
| 分数       |  99.53% | 99.66% |  99.78%  |  98.82%  |   99.89%  |

| 总体情况 | 总准确率 | 文档朝向准确率 | 上下朝向准确率 | 左右朝向准确率 | 文字方向准确率 | 正向文字准确率 | 反向文字准确率 |
|:--------:|:--------:|:-------------:|:-------------:|:-------------:|:-------------:|:--------------:|:-------------:|
| 分数     |  99.53%  | 99.72%        | 99.78%        | 99.67%        | 99.72%        | 100.0%         | 99.45%        |

## 4. 模型对比实验结果

### 模型说明

| 检测模型                      | 模型简介                                                        | 推理模型大小 |
|:-----------------------------:|:--------------------------------------------------------------:|:-----------:|
| ch_ppocr_mobile_v1.1_det      | slim裁剪版超轻量模型，支持中英文、多语种文本检测 (baseline)      | 1.4M        |
| ch_ppocr_mobile_slim_v1.1_det | 原始超轻量模型，支持中英文、多语种文本检测                       | 2.6M        | 
| ch_ppocr_server_v1.1_det      | 通用模型，支持中英文、多语种文本检测，比超轻量模型更大，但效果更好 | 47.2M       |

| 分类模型                        | 模型简介            | 推理模型大小 |
|:------------------------------:|:-------------------:|:------------:|
| ch_ppocr_mobile_v1.1_cls       | 原始模型 (baseline) | 0.5M         |
| ch_ppocr_mobile_v1.1_cls_quant | slim量化版模型      | 850kb        | 

### 测试环境

- GPU : Tesla P100 
- GPU Memory : 16280MB

### 模型对比

| 模型名称                           | 检测时间最少 (ms) | 检测时间最多 (ms) | 检测时间平均 (ms) |
|:----------------------------------:|:----------------:|:----------------:|:----------------:|
| mobile_det + mobile_cls            |   3.48      | 155.72      | 29.90       | 
| mobile_det + mobile_cls_quant      |   3.94      | 145.35      | 31.16       |
| mobile_slim_det + mobile_cls       |   4.72      | 163.60      | 31.99       |
| mobile_slim_det + mobile_cls_quant |   4.52      | 153.80      | 31.62       |
| mobile_server + mobile_cls         |   4.56      | 172.81　    | 35.26       |
| mobile_server + mobile_cls_quant   |   4.59      | 164.14　    | 34.42       |

| 模型名称                           | 中间时间最少 (ms) | 中间时间最多 (ms) | 中间时间平均 (ms) |
|:----------------------------------:|:----------------:|:----------------:|:----------------:|
| mobile_det + mobile_cls            |   0.05      | 196.14　    | 16.77       |
| mobile_det + mobile_cls_quant      |   0.06      | 210.30　    | 17.77       |
| mobile_slim_det + mobile_cls       |   0.04      | 204.72　    | 17.36       |
| mobile_slim_det + mobile_cls_quant |   0.06      | 204.25　    | 17.21       |
| mobile_server + mobile_cls         |   0.07      | 187.31　    | 18.14       |
| mobile_server + mobile_cls_quant   |   0.07      | 182.08　    | 17.70       |

| 模型名称                           | 分类时间最少 (ms) | 分类时间最多 (ms) | 分类时间平均 (ms) |
|:----------------------------------:|:----------------:|:----------------:|:----------------:|
| mobile_det + mobile_cls            |  0 | 163.01        | 18.88        |
| mobile_det + mobile_cls_quant      |  0 | 207.79        | 28.26        |
| mobile_slim_det + mobile_cls       |  0 | 152.58        | 20.34        |
| mobile_slim_det + mobile_cls_quant |  0 | 202.83        | 29.45        |
| mobile_server + mobile_cls         |  0 | 166.92        | 20.94        |
| mobile_server + mobile_cls_quant   |  0 | 205.45        | 30.09        |


| 模型名称                           | 总准确率  | 总时间最少 (ms) | 总时间最多 (ms) | 总时间平均 (ms) | <=20 (ms) | 20 ~ 50 (ms) | 50 ~ 100 (ms) | 100 ~ 200 (ms) | >200 (ms) |
|:----------------------------------:|:--------:|:-----------:|:-------------:|:------------:|:------------:|:-------------:|:--------------:|:-------------:|:-------------:|
| mobile_det + mobile_cls            |  99.53%  | 3.53        | 431.71        | 65.54        | 4.86%        | 38.25%        | 39.97%         | 15.83%        | 1.06%         |
| mobile_det + mobile_cls_quant      |  99.56%  | 4.05        | 478.75        | 77.20        | 2.61%        | 31.78%        | 41.19%         | 21.83%        | 2.56%         |
| mobile_slim_det + mobile_cls       |  99.58%  | 5.79        | 418.20        | 69.69        | 3.75%        | 36.19%        | 40.25%         | 18.28%        | 1.50%         |
| mobile_slim_det + mobile_cls_quant |  99.56%  | 5.32        | 455.64        | 78.27        | 2.33%        | 31.86%        | 41.42%         | 21.17%        | 3.19%         |
| mobile_server + mobile_cls         |**99.67%**| 8.23        | 468.05        | 74.34        | 2.47%        | 33.06%        | 44.08%         | 17.78%        | 2.58%         |
| mobile_server + mobile_cls_quant   |  99.61%  | 9.70        | 464.87        | 82.21        | 1.56%        | 28.31%        | 45.31%         | 20.83%        | 3.97%         |


## 5. 分类框数量对性能的影响分析

### CPU环境

- CPU : Intel® Core™ i7-7500U CPU @ 2.70GHz × 4 
- Memory : 16GB

| 分类框数量 | 总准确率 | 分类任务准确率 | 正向文字分类准确率 | 反向文字分类准确率 |
|:----------:|:-------:|:-------------:|:-----------------:|:-----------------:|
| 5          |  98.67  | 98.83         | 99.72             | 97.97             |
| 10         |**99.39**| **99.58**     | 100.0             | 99.18             |
| all        |  99.53  | 99.72         | 100.0             | 99.45             |

| 分类框数量 | 分类时间最少 (ms) | 分类时间最多 (ms) | 分类时间平均 (ms) |
|:---------:|:-----------------:|:----------------:|:----------------:|
| 5         |   0.00      | 370.4　    | 55.30      |
| 10        |   0.00      | 984.0　    | **110.51** |
| all       |   0.00      | 8117.7　   | 376.26     |

| 分类框数量 | 总时间最少 (ms) | 总时间最多 (ms) | 总时间平均 (ms) |
|:---------:|:--------------:|:---------------:|:--------------:|
|    5      | 28.07      | 3882.69   | 489.20     |
|    10     | 37.32      | 4450.79   | 558.14     |
|    all    | 30.43      | 8651.70   | 802.46     |

### GPU环境

- GPU : Tesla K80
- GPU Memory : 11441MiB

| 分类框数量 | 总准确率 | 分类任务准确率 | 正向文字分类准确率 | 反向文字分类准确率 |
|:----------:|:-------:|:-------------:|:-----------------:|:-----------------:|
| 1          |  93.69  | 93.89         | 95.04             | 92.77             |
| 3          |  98.25  | 98.42         | 98.93             | 97.92             |
| 5          |  99.03  | 99.19         | 99.72             | 98.69             |
| 10         |  99.42  | 99.61         | 99.83             | 99.40             |
| 20         |  99.53  | 99.69         | 99.83             | 99.56             |
| all        |  99.58  | 99.75         | 99.83             | 99.67             |


| 分类框数量 | 分类时间最少 (ms) | 分类时间最多 (ms) | 分类时间平均 (ms) |
|:---------:|:-----------------:|:----------------:|:----------------:|
| 1         |   0.00            | 10.42　          | 5.98             |
| 3         |   0.00            | 18.09　          | 8.70             |
| 5         |   0.00            | 14.07　          | 9.94             |
| 10        |   0.00            | 23.81　          | 18.77            |
| 20        |   0.00            | **42.60**        | 32.50            |
| all       |   0.00            | 285.9 　         | 46.53            |


| 分类框数量 | 总时间最少 (ms) | 总时间最多 (ms) | 总时间平均 (ms) | <=20 (ms) | 20 ~ 50 (ms) | 50 ~ 100 (ms) | 100 ~ 200 (ms) | >200 (ms) |
|:---------:|:--------------:|:---------------:|:--------------:|:---------:|:------------:|:-------------:|:--------------:|:----------:|
|    1      | 9.38       | 385.51    | 82.61      | 0.42%    | 21.94%   | 51.00%   | 24.92%    | 1.69%     |
|    3      | 9.07       | 382.90    | 83.13      | 0.14%    | 20.36%   | 52.64%   | 25.64%    | 1.19%     |
|    5      | 9.10       | 410.49    | 85.18      | 0.14%    | 18.31%   | 52.83%   | 27.31%    | 1.39%     |
|    10     | 9.06       | 395.35    |**95.20**   | 0.08%    | 11.42%   | 50.11%   | 35.89%    | 2.47%     |
|    20     | 9.01       | 430.72    | 106.9      | 0.11%    | 9.81%    | 35.22%   | 51.19%    | 3.64%     |
|    all    | 7.65       | 646.69    | 117.2      | 0.14%    | 13.69%   | 32.53%   | 42.28%    | 11.33%    |

